# 引导手册修复说明

## 问题描述

在 `js/features/manual.js` 文件中出现以下错误：

```
manual.js:248  Uncaught ReferenceError: selectedMentorForQuestion is not defined
    at updateUseQuestionButton (manual.js:248:9)
    at openQuestionModal (manual.js:148:9)
    at HTMLDivElement.<anonymous> (manual.js:103:62)
```

## 问题原因分析

1. **变量未定义**：代码中使用了 `selectedMentorForQuestion` 变量但没有正确定义
2. **函数缺失**：调用了 `toggleMentorSelection` 和 `updateMentorSelection` 函数但没有定义
3. **逻辑不一致**：单导师和多导师模式的处理逻辑混乱

## 修复方案

### 1. 添加缺失变量定义

```javascript
let selectedMentorsForQuestion = [];      // 多导师选择数组
let selectedMentorForQuestion = null;     // 当前选中的单个导师
let conversationMode = 'single';          // 对话模式：'single' 或 'multi'
```

### 2. 完善导师选择逻辑

#### 单导师选择函数 (`selectMentor`)
- 清除之前的选择
- 设置新的选择
- 更新UI显示
- 同步更新单导师和多导师变量

#### 多导师切换函数 (`toggleMentorSelection`) 
- 支持添加/移除导师
- 维护选择状态
- 更新UI指示器

#### 选择状态更新函数 (`updateMentorSelection`)
- 根据当前选择状态更新所有导师卡片的显示
- 添加/移除选中指示器

### 3. 改进按钮状态管理

重构 `updateUseQuestionButton` 函数：
- 支持单导师和多导师两种模式
- 显示不同的选择状态信息
- 动态启用/禁用按钮

### 4. 完善事件处理

#### 导师卡片点击事件
```javascript
mentorCard.addEventListener('click', () => {
    if (conversationMode === 'single') {
        selectMentor(mentor, mentorCard);
    } else {
        toggleMentorSelection(mentor, mentorCard);
    }
});
```

#### 使用问题按钮事件
```javascript
useQuestionBtn.addEventListener('click', function() {
    if (conversationMode === 'single') {
        // 单导师模式处理
        sessionStorage.setItem('selectedMentor', selectedMentorForQuestion.id);
        sessionStorage.setItem('conversationMode', '1v1');
    } else {
        // 多导师模式处理
        sessionStorage.setItem('selectedMentors', JSON.stringify(selectedMentorsForQuestion.map(m => m.id)));
        sessionStorage.setItem('conversationMode', '1vMany');
    }
});
```

## 修复后的功能特性

### ✅ 单导师模式
- 选择一位导师进行1对1对话
- 显示选中导师的名称
- 自动设置对话模式为 `1v1`

### ✅ 多导师模式  
- 可选择多位导师进行圆桌讨论
- 显示所有选中导师的名称和数量
- 自动设置对话模式为 `1vMany`

### ✅ 模式切换
- 从多导师切换到单导师时，自动保留第一个选中的导师
- 从单导师切换到多导师时，保持当前选择

### ✅ UI交互优化
- 选中状态的视觉指示器
- 悬浮效果和动画
- 禁用/启用按钮状态管理

## 测试验证

### 测试步骤
1. 打开引导手册页面
2. 选择任意问题类别
3. 点击具体问题
4. 测试单导师选择
5. 切换到多导师模式
6. 测试多导师选择
7. 验证按钮状态更新
8. 确认跳转到对话页面功能正常

### 预期结果
- 不再出现 `selectedMentorForQuestion is not defined` 错误
- 导师选择功能正常工作
- 单导师和多导师模式切换流畅
- 对话页面能正确接收选择的导师信息

## 兼容性说明

- 修复保持了与现有对话页面的完全兼容性
- sessionStorage 的数据格式与对话页面期望的格式一致
- 支持原有的单导师和圆桌讨论两种模式 